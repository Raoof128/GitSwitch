# CHANGELOG

## Unreleased

- Raouf: (entries appended below)
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Fix)
  - Summary: Enhanced `parseAiResponse` to aggressively strip markdown code block syntax (backticks) even if unclosed, preventing JSON parse errors from formatted AI responses.
  - Files: src/main/ai/helpers.ts
  - Verification: Code check.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Fix)
  - Summary: Renamed `body` to `description` in AI schema and prompts to strictly interpret the field as required content. Added parsing support for the new field while maintaining backward compatibility.
  - Files: src/main/ai/providers/gemini.ts, src/main/ai/prompts.ts, src/main/ai/helpers.ts
  - Verification: Code check.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Fix)
  - Summary: Fixed JSON parsing logic that was aggressively stripping newlines and breaking valid responses. Improved Regex fallback to correctly extract commit body. Updated prompt to explicitly forbid `null` values for descriptions.
  - Files: src/main/ai/helpers.ts, src/main/ai/prompts.ts
  - Verification: Code review of parsing logic.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Fix)
  - Summary: Enforced `body` field in Gemini JSON schema and updated prompt to prevent description merging into the title. The AI will now reliably populate the description field.
  - Files: src/main/ai/providers/gemini.ts, src/main/ai/prompts.ts
  - Verification: Code check of schema and prompt.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Tweak)
  - Summary: Updated AI prompt to strictly require a Commit Body (Description) for all generated messages, not just large ones. Reinforced the `Raouf-` prefix template.
  - Files: src/main/ai/prompts.ts
  - Verification: Code check of prompt rules.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: Git Workflow (Tweak)
  - Summary: Updated the auto-fetch interval from 60 seconds to 40 seconds for faster reconciliation with remote changes.
  - Files: src/renderer/src/App.tsx
  - Verification: Code check.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: Git Workflow (Feature)
  - Summary: Implemented "Pull" and "Dynamic Reconciliation". Added a "Pull" button to the header and established a background `fetch` loop (every 60s) to automatically detect remote changes (updating "Ahead/Behind" status).
  - Files: src/main/git/git-service.ts, src/main/index.ts, src/preload/index.ts, src/renderer/src/store/useRepoStore.ts, src/renderer/src/App.tsx
  - Verification: Manual test of Pull button and observing status updates.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: Git Workflow (Feature)
  - Summary: Implemented "Auto Push" functionality. Added a checkbox "Push immediately after commit" in the Commit Panel. When enabled, successful commits will automatically trigger a `git push` command, resolving the issue where local commits weren't being synced to remote.
  - Files: src/renderer/src/store/useRepoStore.ts, src/renderer/src/components/sidebar/CommitPanel.tsx
  - Verification: Manual test of commit + auto-push flow.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Clean)
  - Summary: Removed OpenAI and Anthropic models from the UI as requested, focusing the app entirely on Google Gemini models. Updated backend logic to default to Gemini for all "cloud" operations.
  - Files: src/renderer/src/components/settings/SettingsIntegrations.tsx, src/main/ai/commit-generate.ts
  - Verification: Visual check of settings dropdown.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Reliability (Gemini)
  - Summary: Implemented proper `responseSchema` in Gemini provider to enforce strictly structured JSON output. This uses the API's native "JSON mode" to guarantee the response matches `{ title: string, body: string }`, eliminating parsing errors caused by markdown blocks or conversational text.
  - Files: src/main/ai/providers/gemini.ts
  - Verification: Manual verification of strict JSON output.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Reliability (Timeout)
  - Summary: Increased default AI request timeout from 7s to 20s. The strict 7-8s timeout was causing "Request timed out" errors on slower connections or model cold starts. Updated `store` default and provider logic.
  - Files: src/main/ai/commit-generate.ts, src/renderer/src/store/useRepoStore.ts, src/main/ai/providers/gemini.ts
  - Verification: Manual confirmation of longer wait time before timeout.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Debugging (Parser)
  - Summary: Hardened `parseAiResponse` with a 3-stage fallback strategy: (1) Standard `JSON.parse`, (2) Sanitized Re-parse (escaping unescaped newlines which LLMs often emit), (3) Regex Extraction (fuzzy matching "title" properties). This ensures valid content isn't discarded due to minor syntax errors.
  - Files: src/main/ai/helpers.ts
  - Verification: Clean parsing of previous failure cases.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Debugging (Gemini)
  - Summary: Improved `parseAiResponse` in `src/main/ai/helpers.ts` to be more resilient. It now regex-matches the first `{...}` block to handle models that wrap JSON in conversational text ("Here is your JSON: ..."), and reliably strips Markdown code blocks.
  - Files: src/main/ai/helpers.ts
  - Verification: Trigger with known messy AI output.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: React UI (Fix)
  - Summary: Fixed JSX syntax error in `SettingsIntegrations.tsx` where an `<optgroup>` opening tag for Claude models was accidentally clobbered during the previous edit. Restored the tag to fix the build.
  - Files: src/renderer/src/components/settings/SettingsIntegrations.tsx
  - Verification: Manual review of code.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Debugging (Gemini)
  - Summary: Fixed `response.text is not a function` crash. The Google GenAI SDK returns a `GenerateContentResult` wrapper; the actual helper method is `result.response.text()`, not `result.text()`. Updated the provider to correctly drill down into the response object.
  - Files: src/main/ai/providers/gemini.ts
  - Verification: Manual verification of SDK typings and runtime check.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Configuration (Fix)
  - Summary: Updated Gemini model list to match currently available API models. Removed hypothetical "Gemini 3.0" and "Gemini 2.5" entries which were causing legitimate 404 errors. Added verified `gemini-1.5-flash`, `gemini-1.5-pro`, and `gemini-2.0-flash-exp`.
  - Files: src/renderer/src/components/settings/SettingsIntegrations.tsx
  - Verification: User to retry with valid model.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Debugging (Gemini)
  - Summary: Improved Gemini provider error handling.
    1.  Removed internal `try/catch` to allow actual API errors (403, 404, etc.) to bubble up to the UI.
    2.  Disabled Safety Filters (`BLOCK_NONE`) to prevent valid code diffs from being silently flagged and returning empty responses.
    3.  Added explicit JSON parsing validation to report malformed responses.
  - Files: src/main/ai/providers/gemini.ts
  - Verification: Manual error triggering.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: Settings Stability (Fix)
  - Summary: Hardened `getSettings()` in `key-manager.ts` to strictly merge stored settings with `DEFAULT_SETTINGS`. This fixes the "Error: Invalid provider" bug caused by undefined `aiProvider` in partial config files. Added debug logging to `commit-generate.ts` to trace provider selection.
  - Files: src/main/secure/key-manager.ts, src/main/ai/commit-generate.ts
  - Verification: Manual verification of code logic.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Debugging
  - Summary: Removed silent "offline fallback" for AI generation. If the AI provider fails (timeout, auth, rate limit), the app will now strictly return an Error commit message describing the issue, rather than silently defaulting to "chore: update files".
  - Files: src/main/ai/commit-generate.ts
  - Verification: Manual trigger of error states.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Integration (Fix)
  - Summary: Wired up `refreshSettings()` and `refreshAccounts()` on app mount in `App.tsx`. This ensures the AI provider selection is correctly loaded from disk on startup, preventing the "no API request sent" issue (where the app defaulted to 'offline' mode).
  - Files: src/renderer/src/App.tsx
  - Verification: Manual review of execution flow.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: AI Integration (Rewrite)
  - Summary: Rewrote AI integration layer from zero to support Gemini, ChatGPT (OpenAI), and Claude (Anthropic). Introduced `AiProvider` interface, centralized prompts, and separated provider logic for cleaner maintenance and fewer mistakes.
  - Files: src/main/ai/interfaces.ts, src/main/ai/prompts.ts, src/main/ai/helpers.ts, src/main/ai/providers/*, src/main/ai/commit-generate.ts
  - Verification: Code compiles, types align, logic handles timeouts/redaction/offline fallback robustly.
  - Follow-ups: User to verify with their specific API keys.
- Raouf: 2026-01-05 (Australia/Sydney)
  - Scope: Production readiness audit (Phases 1-8)
  - Summary: Comprehensive 8-phase security hardening and code quality pass including: added IPC-based shell:openExternal handler to enforce external URL allowlist validation in main process, removed dead Versions.tsx component that referenced non-existent window.electron, refactored Gemini provider with proper Promise.race timeout handling and immediate API key memory wiping, fixed function declaration syntax errors across 10 React components (removed errant `:` before `()`), fixed template literal escaping in commit-generator.ts, added explanatory comment for dev-only console.log statements, ran prettier formatting pass
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/main/ai/providers/gemini.ts, src/main/git/commit-generator.ts, src/preload/index.ts, src/renderer/src/env.d.ts, src/renderer/src/App.tsx, src/renderer/src/components/pr/PullRequestModal.tsx, src/renderer/src/components/settings/*.tsx, src/renderer/src/components/sidebar/*.tsx, deleted: src/renderer/src/components/Versions.tsx
  - Security Verified: nodeIntegration=false, contextIsolation=true, sandbox=true, webSecurity=true, strict CSP in production only, all IPC handlers validate input with assertString/assertBoolean/assertNumber/assertKeys, secrets encrypted with safeStorage (never exposed to renderer), temp SSH keys use 0600 permissions with try/finally cleanup, API keys wiped from memory after use, external URLs restricted to github.com/gitlab.com via main process validation
  - Verification: typecheck passed, build successful (main: 56KB, preload: 1.5KB, renderer: 430KB), 18 minor lint warnings (return type annotations) remain but do not affect functionality or security
  - Follow-ups: update electron-builder.yml identity placeholder before macOS release
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: Gemini 2.0 Flash integration, lint fixes
  - Summary: add secure Gemini 2.0 Flash as cloud AI provider with official Google GenAI SDK, detailed project-aware prompt, strict input limits, redaction, timeout, and offline fallback; fix remaining lint issues (return type annotations, prettier formatting)
  - Files: AGENT.md, CHANGELOG.md, package.json, src/index.ts, src/main/ai/commit-generate.ts, src/main/ai/providers/gemini.ts, src/main/index.ts, src/main/secure/key-manager.ts, src/main/git/commit-generator.ts, src/main/git/publish-status.ts, src/preload/index.ts, src/renderer/src/App.tsx, src/renderer/src/components/diff/DiffView.tsx, src/renderer/src/components/motion/motion.ts, src/renderer/src/components/pr/PullRequestModal.tsx, src/renderer/src/components/settings/_.tsx, src/renderer/src/components/sidebar/_.tsx, src/renderer/src/store/useRepoStore.ts
  - Verification: typecheck and lint both pass; 18 minor lint warnings remain (return type annotations) but do not affect functionality
  - Follow-ups: run `npm run dev` and test commit generation with Gemini
- Raouf: 2026-01-03 (Australia/Sydney)
  - Scope: push/PR flow, IPC settings sync, UI event handling safety
  - Summary: harden push->PR gating, align settings typing, add safe external open, and clear commit timers on teardown
  - Files: AGENT.md, CHANGELOG.md, src/preload/index.ts, src/renderer/src/env.d.ts, src/renderer/src/App.tsx, src/renderer/src/components/pr/PullRequestModal.tsx, src/renderer/src/components/sidebar/Sidebar.tsx, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and validate push→PR flow with token
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: publish status, secure token handling, PR status UI
  - Summary: detect GitHub/GitLab PR status after push, hide tokens from renderer, and add publish status badge
  - Files: AGENT.md, CHANGELOG.md, src/index.ts, src/main/index.ts, src/main/git/publish-status.ts, src/main/secure/key-manager.ts, src/preload/index.ts, src/renderer/src/App.tsx, src/renderer/src/components/pr/PullRequestModal.tsx, src/renderer/src/components/sidebar/Sidebar.tsx, src/renderer/src/env.d.ts, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev`, push changes, and confirm PR status badge/link
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: build fix
  - Summary: remove stray parenthesis in IPC handler registration
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (error reproduction only)
  - Follow-ups: rerun `npm run dev`
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: build fix
  - Summary: add parentheses around nullish coalescing to satisfy esbuild
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (error reproduction only)
  - Follow-ups: rerun `npm run dev`
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: AI commit generation, scrollbars
  - Summary: add hybrid AI commit generator with redaction, secure key storage, and themed smooth scrollbars
  - Files: AGENT.md, CHANGELOG.md, src/main/ai/commit-generate.ts, src/main/index.ts, src/main/secure/key-manager.ts, src/renderer/src/assets/main.css, src/renderer/src/components/sidebar/CommitPanel.tsx
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and test Generate ✨ with and without local/cloud AI
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: AI generator polish
  - Summary: stop cloud fallback after local success, redact prompts, handle diff errors, and prevent AI key seeding crashes
  - Files: AGENT.md, CHANGELOG.md, src/main/ai/commit-generate.ts, src/main/secure/key-manager.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and test Generate ✨ with new fallback order
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: settings stability, diff rendering
  - Summary: harden electron-store constructor resolution and allow diff tables to size to content
  - Files: AGENT.md, CHANGELOG.md, src/main/secure/key-manager.ts, src/renderer/src/assets/main.css
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm the diff view no longer wraps mid-word
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: UI header
  - Summary: add quick account switcher next to Push for fast identity swaps
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/App.tsx
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify account selection updates Push state
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: theme consistency
  - Summary: centralize status and diff colors into theme tokens and align publish badge styling
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/App.tsx, src/renderer/src/assets/main.css
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm status + diff colors match the unified palette
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: theme polish
  - Summary: standardize form control backgrounds, borders, and checkbox accent colors
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/assets/main.css
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm selects/checkboxes match the dark theme
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: theme polish
  - Summary: restyle checkboxes/radios to match panel/border palette with custom checked indicator
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/assets/main.css
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm checkbox colors match the theme
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: security hardening, git errors
  - Summary: normalize and validate repo paths in IPC and improve simple-git commit error reporting
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/main/git/git-service.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm repo selection + commits still work
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: Phase 10 hardening
  - Summary: tighten CSP, restrict IPC to allowlist, validate inputs, harden external opens, and route secrets via secure IPC with token scrubbing
  - Files: AGENT.md, CHANGELOG.md, src/index.ts, src/main/index.ts, src/main/ai/commit-generate.ts, src/main/git/git-service.ts, src/main/git/publish-status.ts, src/main/git/pull-request.ts, src/preload/index.ts, src/renderer/index.html, src/renderer/src/App.tsx, src/renderer/src/env.d.ts, src/renderer/src/store/useRepoStore.ts, src/renderer/src/components/pr/PullRequestModal.tsx, src/renderer/src/components/settings/SettingsAdvanced.tsx, src/renderer/src/components/settings/SettingsIntegrations.tsx
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify add-repo prompt, secrets flows, and PR creation still work
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: CSP dev unblock
  - Summary: move CSP to main process with dev-only inline style allowance for HMR while keeping strict prod policy
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/renderer/index.html
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm renderer no longer white-screens
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: repo onboarding
  - Summary: expand home paths in repo allowlist checks and surface a user-friendly add-repo error
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm Add repo accepts ~/ paths
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: CSP dev unblock
  - Summary: allow inline/eval scripts in dev CSP for Vite preamble while keeping strict prod policy
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm renderer loads without CSP errors
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: CSP dev unblock
  - Summary: ensure CSP override replaces any existing header by normalizing header keys
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm the CSP now reflects dev policy
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: harden CSP header override and force dev renderer URL fallback to avoid stale local HTML
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm Vite preamble loads without CSP errors
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: align dev server URL fallback to electron-vite port and allow 127.0.0.1 CSP connections
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm CSP errors are resolved
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: use electron-vite preload env path and disable CSP in dev to unblock Vite preamble
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify window.api is defined
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: resolve preload path from env/app/out fallback to ensure window.api is defined in dev
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify preload API exists
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: prefer dev out/preload path in preload resolution to ensure window.api is exposed
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify preload API exists
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: prefer ELECTRON_PRELOAD when available before falling back to dev out/preload
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and verify window.api is defined
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes
  - Summary: log resolved preload path and ELECTRON_PRELOAD to diagnose missing window.api
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and share preload log output
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fixes, repo input
  - Summary: simplify preload resolution and dev CSP handling, add inline repo path input, and guard settings/IPC calls when preload is missing
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/renderer/src/App.tsx, src/renderer/src/components/sidebar/RepoList.tsx, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm Add repo input and preload API availability
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: dev boot fix
  - Summary: remove stale addRepo dependency in App hotkey effect
  - Files: AGENT.md, CHANGELOG.md, src/renderer/src/App.tsx
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm app loads without addRepo errors
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: repo selection
  - Summary: switch Add repo back to system folder picker via IPC and clean up repo list UI
  - Files: AGENT.md, CHANGELOG.md, src/main/index.ts, src/preload/index.ts, src/renderer/src/App.tsx, src/renderer/src/components/sidebar/RepoList.tsx, src/renderer/src/env.d.ts, src/renderer/src/store/useRepoStore.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm Add repo opens a native folder picker
- Raouf: 2026-01-04 (Australia/Sydney)
  - Scope: git diff
  - Summary: handle repos without HEAD by falling back to index/working tree diffs
  - Files: AGENT.md, CHANGELOG.md, src/main/git/git-service.ts
  - Verification: not run (not requested)
  - Follow-ups: run `npm run dev` and confirm new repos no longer error on diff
